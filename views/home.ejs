<html>

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <style>
        .content{
            width:1000px;
            margin:auto;
        }
        .form{
            width: 70%;
            margin: auto;
        }
    </style>

</head>

<body>

    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand">Spheremail</a>
        <button onclick="logout()">logout</button>
    </nav>
    <div class="content">
        <form class="form">
            <h1>Add Event</h1>
            <div class="form-group">
                <label for="exampleInputEmail1">Title</label>
                <input type="text" class="form-control" id="title" placeholder="Enter title">
            </div>
            <div class="form-group">
                <label for="exampleInputEmail1">Subtitle</label>
                <input type="text" class="form-control" id="subtitle" placeholder="Enter subtitle">
            </div>
            <div class="form-group">
                <label for="exampleInputEmail1">Description</label>
                <input type="text" class="form-control" id="description" placeholder="Enter description">
            </div>
            <div class="form-group">
                <label for="exampleInputEmail1">Body</label>
                <textarea class="form-control" id="body"></textarea>
            </div>
            <div class="form-group">
                <label for="exampleInputEmail1">Date</label>
                <input type="datetime-local" class="form-control" id="date" placeholder="Enter description">
            </div>
            <div class="form-group">
                <label for="exampleInputEmail1">Type</label>
                <select class="form-control" id="type">
                    <option>WEBINAR</option>
                    <option>PODCAST</option>
                  </select>
            </div>
            <button type="submit" class="btn btn-primary" onclick='return add_event()'>Submit</button>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>
    <script>

        function logout() {
            localStorage.removeItem("token");
            window.location.href = '/login';
        }
        function add_event(){
            let reqBody = {}
            let fields = ['title', 'subtitle', 'body', 'description', 'type', 'date']
            for(let i = 0; i<fields.length; i++){
                field = fields[i]
                reqBody[field] = document.getElementById(field).value;
            }

            var myHeaders = new Headers();
            myHeaders.append('Content-Type', 'application/json');
            var token = localStorage.getItem("token");
            myHeaders.append('authorization', 'bearar '+token);
            fetch('/api/event',{
                method: "POST",
                mode: "cors",
                cache: "no-cache",
                credentials: "same-origin",
                headers: myHeaders,
                redirect: "follow",
                referrerPolicy: "no-referrer",
                body: JSON.stringify(reqBody),
            })
            .then(response =>{
                if(response.status != 200){
                    throw new Error("noPermissions");
                }
                return response.json()
            })
            .then(data => {
                    console.log(data);
                    alert("Restarted successfully!");
            })
            .catch(error => {
                if(error.message == 'noPermissions'){
                    alert("You are not permitted!");
                }
                else{
                    alert("Network Errors!");
                }
            });
            return false;
            
        }
    </script>
</body>
</html>